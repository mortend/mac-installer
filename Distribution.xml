<?xml version="1.0" encoding="utf-8" standalone="no"?>
<installer-gui-script minSpecVersion="2">
    
    <title>fuse X</title>
    <organization>kr.fuseapps</organization>
    <license file="license.html" />

    <domains enable_localSystem="true"/>
    <options customize="never" require-scripts="true" rootVolumeOnly="true" />

    <!--<app id="kr.fuseapps.studio"/>-->
    <!--<app id="kr.fuseapps.tray"/>-->

    <allowed-os-versions>
        <os-version min="10.10" />
    </allowed-os-versions>

    <script>
        <![CDATA[
            function checkDependencies() {
                var isInstalled = function(name, loc, url) {
                    return !system.files.fileExistsAtPath(loc)
                        ? "'" + loc + "' was not found.\nPlease install " + name + " and try again.\n" + url + "\n\n"
                        : "";
                };

                var missing = isInstalled('Mono', '/Library/Frameworks/Mono.framework/Versions/Current/Commands/mono', 'https://www.mono-project.com/download/')
                            + isInstalled('Node.js', '/usr/local/bin/node', 'https://nodejs.org/en/download/')
                            + isInstalled('NPM', '/usr/local/bin/npm', 'https://nodejs.org/en/download/')
                            + isInstalled('Xcode Command Line Tools', '/usr/bin/xcodebuild', 'https://developer.apple.com/xcode/');

                if (missing.length > 0) {
                    my.result.title = 'Missing dependencies'; 
                    my.result.message = missing;
                    my.result.type = 'Fatal';
                    return false; 
                }

                return true;
            }
        ]]>
    </script>

    <installation-check script="checkDependencies()" />

    <pkg-ref id="kr.fuseapps.studio"/>
    
    <choices-outline>
        <line choice="default">
            <line choice="kr.fuseapps.studio"/>
        </line>
    </choices-outline>
    
    <choice id="default"/>
    
    <choice id="kr.fuseapps.studio" visible="false">
        <pkg-ref id="kr.fuseapps.studio"/>
    </choice>

    <pkg-ref id="kr.fuseapps.studio" onConclusion="none">fuse-studio.pkg</pkg-ref>

</installer-gui-script>