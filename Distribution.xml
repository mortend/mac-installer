<?xml version="1.0" encoding="utf-8" standalone="no"?>
<installer-gui-script minSpecVersion="2">
    
    <title>fuse X</title>
    <organization>kr.fuseapps</organization>
    <license file="license.html" />
    <app id="kr.fuseapps.tray"/>
    <domains enable_localSystem="true"/>
    <options customize="never" require-scripts="true" rootVolumeOnly="true" />

    <allowed-os-versions>
        <!-- Mountain Lion -->
        <os-version min="10.8" />
    </allowed-os-versions>

    <script>
        <![CDATA[
            function checkDependencies() {
                var isInstalled = function(name, loc, url) {
                    if (!system.files.fileExistsAtPath(loc))
                        return "'" + loc + "' was not found.\nPlease install " + name + ".\n" + url + "\n\n";
                    return "";
                };

                var missing = isInstalled('Node.js', '/usr/local/bin/node', 'https://nodejs.org/en/download/')
                            + isInstalled('NPM', '/usr/local/bin/npm', 'https://nodejs.org/en/download/')
                            + isInstalled('Xcode Command Line Tools', '/usr/bin/xcodebuild', 'https://developer.apple.com/xcode/');

                if (missing.length > 0) {
                    my.result.title = 'Missing dependencies'; 
                    my.result.message = missing;
                    my.result.type = 'Fatal';
                    return false; 
                }

                return true;
            }
        ]]>
    </script>

    <installation-check script="checkDependencies()" />

    <pkg-ref id="kr.fuseapps.x"/>
    
    <choices-outline>
        <line choice="default">
            <line choice="kr.fuseapps.x"/>
        </line>
    </choices-outline>
    
    <choice id="default"/>
    
    <choice id="kr.fuseapps.x" visible="false">
        <pkg-ref id="kr.fuseapps.x"/>
    </choice>

    <pkg-ref id="kr.fuseapps.x" version="1.15" onConclusion="none">fuse-x.pkg</pkg-ref>

</installer-gui-script>