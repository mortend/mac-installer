#!/bin/sh
export PATH=/usr/local/bin:$PATH
export TGZ=/tmp/fuse-x-studio-mac-2.0.0-beta.1.tgz
export DST=`npm prefix -g`/lib/node_modules/@fuse-x/studio-mac
export BIN=$DST/bin/Release
export APP=$BIN/fuse\ X.app
export EXE=$BIN/fuse.exe

if [ -n "$SUDO_USER" ]; then
	export USER=$SUDO_USER
fi

echo USER: $USER
echo $USER > /tmp/USER

# Install
chown -R "$USER" "$DST"
su "$USER" -c 'npm install -g -f "$TGZ"' || exit 1
su "$USER" -c 'mono "$EXE" --version' || exit 1
su "$USER" -c 'mono "$EXE" kill-all'

# Copy app
cp -R "$APP" /Applications/
echo "require \"$DST/.unoconfig\"\n" \
	> /Applications/fuse\ X.app/Contents/.unoconfig
chown -R "$USER" /Applications/fuse\ X.app

# Reset permissions
#chown -R root:wheel /Applications/fuse\ X.app
#chmod +x /Applications/fuse\ X.app/Contents/SketchImporter/fondu
